#include <stringstream.h>

#define TYPENAME StringStream

////////////////////////////////////////////////////////////////////////////////
StringStream *_(Construct)(String *current)
{
  CharStream_Construct(BASE(0), NEW (String) (current->base));

  this->pos = 0;

  return this;
}

////////////////////////////////////////////////////////////////////////////////
void _(Destruct)()
{
  CharStream_Destruct(BASE(0));
}

////////////////////////////////////////////////////////////////////////////////
void _(Close)()
{
  DELETE (*BASE(2));
}

////////////////////////////////////////////////////////////////////////////////
int _(Peek)()
{
  String *base = *BASE(2);

  return base->base[this->pos];
}

////////////////////////////////////////////////////////////////////////////////
int _(Get)()
{
  int peek = StringStream_Peek(this);

  if (!(BASE(1)->eos = !peek)) ++this->pos;

  return peek;
}

////////////////////////////////////////////////////////////////////////////////
void _(Unget)(int c)
{
  String *base = *BASE(2);

  if (!this->pos) {
    String_Prepend(base, c);
  } else {  
    base->base[--this->pos] = c;
  }

  BASE(1)->eos = 0;
}


////////////////////////////////////////////////////////////////////////////////
void _(Put)(int c)
{
  String *base = *BASE(2);

  String_Insert(base, this->pos++, c);
}

#undef TYPENAME
